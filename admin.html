<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Trung t√¢m ABC</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-nav">
            <div class="admin-logo">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <h2><i class="fas fa-graduation-cap"></i> Trung t√¢m Ngo·∫°i ng·ªØ - Tin h·ªçc HNMT</h2>
            </div>
            <div class="admin-user">
                <span id="adminName">Admin User</span>
                <button class="btn-admin-logout" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>
    </header>

    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
        <nav class="admin-menu">
            <ul>
                <li class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="menu-item" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
                </li>
                <li class="menu-item" data-section="courses">
                    <i class="fas fa-book"></i>
                    <span>Qu·∫£n l√Ω kh√≥a h·ªçc</span>
                </li>
                <li class="menu-item" data-section="enrollments">
                    <i class="fas fa-user-graduate"></i>
                    <span>ƒêƒÉng k√Ω kh√≥a h·ªçc</span>
                </li>
                <li class="menu-item" data-section="consultations">
                    <i class="fas fa-comments"></i>
                    <span>T∆∞ v·∫•n & Li√™n h·ªá</span>
                </li>
                <li class="menu-item" data-section="content">
                    <i class="fas fa-edit"></i>
                    <span>Qu·∫£n l√Ω n·ªôi dung</span>
                </li>
                <li class="menu-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Th·ªëng k√™ & B√°o c√°o</span>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Admin Main Content -->
    <main class="admin-main">
        <!-- Dashboard Section -->
        <section id="dashboard" class="admin-section active">
            <div class="section-header">
                <h1>Dashboard</h1>
                <p>T·ªïng quan h·ªá th·ªëng</p>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">0</h3>
                        <p>T·ªïng ng∆∞·ªùi d√πng</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon courses">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalCourses">6</h3>
                        <p>Kh√≥a h·ªçc</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon enrollments">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalEnrollments">0</h3>
                        <p>ƒêƒÉng k√Ω kh√≥a h·ªçc</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon consultations">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalConsultations">0</h3>
                        <p>Y√™u c·∫ßu t∆∞ v·∫•n</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-charts">
                <div class="chart-container">
                    <h3>ƒêƒÉng k√Ω theo th√°ng</h3>
                    <canvas id="enrollmentChart"></canvas>
                </div>
                <div class="recent-activities">
                    <h3>Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
                    <div id="recentActivities" class="activity-list">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Users Management Section -->
        <section id="users" class="admin-section">
            <div class="section-header">
                <h1>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
                <button class="btn btn-primary" onclick="showAddUserModal()">
                    <i class="fas fa-plus"></i> Th√™m h·ªçc vi√™n
                </button>
            </div>
            
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>H·ªç t√™n</th>
                            <th>Email</th>
                            <th>Ng√†y ƒëƒÉng k√Ω</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Courses Management Section -->
        <section id="courses" class="admin-section">
            <div class="section-header">
                <h1>Qu·∫£n l√Ω kh√≥a h·ªçc</h1>
                <button class="btn btn-primary" onclick="showAddCourseModal()">
                    <i class="fas fa-plus"></i> Th√™m kh√≥a h·ªçc
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-filters">
                    <input type="text" id="courseSearch" placeholder="T√¨m ki·∫øm kh√≥a h·ªçc...">
                    <select id="courseCategoryFilter">
                        <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                        <option value="language">Ngo·∫°i ng·ªØ</option>
                        <option value="it">Tin h·ªçc</option>
                        <option value="marketing">Marketing</option>
                    </select>
                    <select id="courseStatusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="active">Ho·∫°t ƒë·ªông</option>
                        <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                    </select>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n kh√≥a h·ªçc</th>
                            <th>Danh m·ª•c</th>
                            <th>H·ªçc ph√≠</th>
                            <th>Th·ªùi l∆∞·ª£ng</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTableBody">
                        <!-- Courses will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Enrollments Section -->
        <section id="enrollments" class="admin-section">
            <div class="section-header">
                <h1>Qu·∫£n l√Ω ƒëƒÉng k√Ω kh√≥a h·ªçc</h1>
            </div>
            
            <div class="table-container">
                <div class="table-filters">
                    <input type="text" id="enrollmentSearch" placeholder="T√¨m ki·∫øm ƒëƒÉng k√Ω...">
                    <select id="enrollmentStatusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                        <option value="approved">ƒê√£ duy·ªát</option>
                    </select>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>H·ªçc vi√™n</th>
                            <th>Kh√≥a h·ªçc</th>
                            <th>Ng√†y ƒëƒÉng k√Ω</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="enrollmentsTableBody">
                        <!-- Enrollments will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>



        <!-- Consultations Section -->
        <section id="consultations" class="admin-section">
            <div class="section-header">
                <h1>Y√™u c·∫ßu t∆∞ v·∫•n & Li√™n h·ªá</h1>
            </div>
            
            <div class="table-container">
                <div class="table-filters">
                    <input type="text" id="consultationSearch" placeholder="T√¨m ki·∫øm y√™u c·∫ßu...">
                    <select id="consultationStatusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="new">M·ªõi</option>
                        <option value="processing">ƒêang x·ª≠ l√Ω</option>
                        <option value="completed">Ho√†n th√†nh</option>
                    </select>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>H·ªç t√™n</th>
                            <th>Email</th>
                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                            <th>Kh√≥a h·ªçc quan t√¢m</th>
                            <th>Ng√†y g·ª≠i</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="consultationsTableBody">
                        <!-- Consultations will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Content Management Section -->
        <section id="content" class="admin-section">
            <div class="section-header">
                <h1>Qu·∫£n l√Ω n·ªôi dung</h1>
                <button class="btn btn-primary" onclick="showAddContentModal()">
                    <i class="fas fa-plus"></i> Th√™m n·ªôi dung
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-filters">
                    <input type="text" id="contentSearch" placeholder="T√¨m ki·∫øm n·ªôi dung...">
                    <select id="contentTypeFilter">
                        <option value="">T·∫•t c·∫£ lo·∫°i</option>
                        <option value="contact_info">Th√¥ng tin li√™n h·ªá</option>
                        <option value="announcement">Th√¥ng b√°o</option>
                    </select>
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Lo·∫°i n·ªôi dung</th>
                            <th>Ti√™u ƒë·ªÅ</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>C·∫≠p nh·∫≠t</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="contentTableBody">
                        <!-- Content will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Analytics & Reports Section -->
        <section id="analytics" class="admin-section">
            <div class="section-header">
                <h1>Th·ªëng k√™ ƒë∆°n gi·∫£n</h1>
                <p>T·ªïng quan c√°c s·ªë li·ªáu c∆° b·∫£n</p>
            </div>
            
            <!-- Basic Stats -->
            <div class="analytics-container">
                <h3>üìä Th·ªëng k√™ t·ªïng quan</h3>
                <div class="analytics-stats">
                    <div class="stat-card">
                        <div class="stat-icon analytics">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="analyticsUsers">0</h3>
                            <p>T·ªïng ng∆∞·ªùi d√πng</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon analytics">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="analyticsEnrollments">0</h3>
                            <p>ƒêƒÉng k√Ω kh√≥a h·ªçc</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon analytics">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="analyticsConsultations">0</h3>
                            <p>Y√™u c·∫ßu t∆∞ v·∫•n</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon analytics">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="analyticsVisits">0</h3>
                            <p>L∆∞·ª£t truy c·∫≠p h√¥m nay</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simple Reports -->
            <div class="simple-reports">
                <div class="report-card">
                    <h4>üìà Kh√≥a h·ªçc ph·ªï bi·∫øn</h4>
                    <div id="popularCourses" class="report-content">
                        <p>ƒêang t·∫£i...</p>
                    </div>
                </div>
                
                <div class="report-card">
                    <h4>üìÖ Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h4>
                    <div id="recentActivity" class="report-content">
                        <p>ƒêang t·∫£i...</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

    <!-- Modals -->
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Th√™m h·ªçc vi√™n m·ªõi</h2>
                <span class="close" onclick="closeAdminModal('addUserModal')">&times;</span>
            </div>
            <form id="addUserForm" class="admin-form">
                <div class="form-group">
                    <label>H·ªç v√† t√™n</label>
                    <input type="text" name="full_name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u t·∫°m th·ªùi</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Th√™m h·ªçc vi√™n</button>
            </form>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="addCourseModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Th√™m kh√≥a h·ªçc m·ªõi</h2>
                <span class="close" onclick="closeAdminModal('addCourseModal')">&times;</span>
            </div>
            <form id="addCourseForm" class="admin-form">
                <div class="form-group">
                    <label>T√™n kh√≥a h·ªçc</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£ kh√≥a h·ªçc</label>
                    <textarea name="description" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Danh m·ª•c</label>
                        <select name="category" required>
                            <option value="language">Ngo·∫°i ng·ªØ</option>
                            <option value="it">Tin h·ªçc</option>
                            <option value="marketing">Marketing</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>H·ªçc ph√≠ (VNƒê/th√°ng)</label>
                        <input type="number" name="price" required min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Th·ªùi l∆∞·ª£ng (th√°ng)</label>
                        <input type="number" name="duration" required min="1">
                    </div>
                    <div class="form-group">
                        <label>Tr√¨nh ƒë·ªô</label>
                        <select name="level">
                            <option value="C∆° b·∫£n">C∆° b·∫£n</option>
                            <option value="Trung c·∫•p">Trung c·∫•p</option>
                            <option value="N√¢ng cao">N√¢ng cao</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>L·ªãch h·ªçc</label>
                    <input type="text" name="schedule" placeholder="VD: Th·ª© 2, 4, 6 - 19:00-21:00">
                </div>
                <div class="form-group">
                    <label>T√≠nh nƒÉng n·ªïi b·∫≠t</label>
                    <textarea name="features" rows="4" placeholder="M·ªói t√≠nh nƒÉng m·ªôt d√≤ng"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Th√™m kh√≥a h·ªçc</button>
            </form>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div id="editCourseModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Ch·ªânh s·ª≠a kh√≥a h·ªçc</h2>
                <span class="close" onclick="closeAdminModal('editCourseModal')">&times;</span>
            </div>
            <form id="editCourseForm" class="admin-form">
                <input type="hidden" name="course_id" id="editCourseId">
                <div class="form-group">
                    <label>T√™n kh√≥a h·ªçc</label>
                    <input type="text" name="title" id="editCourseTitle" required>
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£ kh√≥a h·ªçc</label>
                    <textarea name="description" id="editCourseDescription" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Danh m·ª•c</label>
                        <select name="category" id="editCourseCategory" required>
                            <option value="language">Ngo·∫°i ng·ªØ</option>
                            <option value="it">Tin h·ªçc</option>
                            <option value="marketing">Marketing</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>H·ªçc ph√≠ (VNƒê/th√°ng)</label>
                        <input type="number" name="price" id="editCoursePrice" required min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Th·ªùi l∆∞·ª£ng (th√°ng)</label>
                        <input type="number" name="duration" id="editCourseDuration" required min="1">
                    </div>
                    <div class="form-group">
                        <label>Tr√¨nh ƒë·ªô</label>
                        <select name="level" id="editCourseLevel">
                            <option value="C∆° b·∫£n">C∆° b·∫£n</option>
                            <option value="Trung c·∫•p">Trung c·∫•p</option>
                            <option value="N√¢ng cao">N√¢ng cao</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>L·ªãch h·ªçc</label>
                    <input type="text" name="schedule" id="editCourseSchedule" placeholder="VD: Th·ª© 2, 4, 6 - 19:00-21:00">
                </div>
                <div class="form-group">
                    <label>T√≠nh nƒÉng n·ªïi b·∫≠t</label>
                    <textarea name="features" id="editCourseFeatures" rows="4" placeholder="M·ªói t√≠nh nƒÉng m·ªôt d√≤ng"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t kh√≥a h·ªçc</button>
            </form>
        </div>
    </div>

    <!-- Course Detail Modal -->
    <div id="courseDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chi ti·∫øt kh√≥a h·ªçc</h2>
                <span class="close" onclick="closeAdminModal('courseDetailModal')">&times;</span>
            </div>
            <div class="modal-body" id="courseDetailContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Content Modal -->
    <div id="addContentModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Th√™m n·ªôi dung m·ªõi</h2>
                <span class="close" onclick="closeAdminModal('addContentModal')">&times;</span>
            </div>
            <form id="addContentForm" class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Lo·∫°i n·ªôi dung</label>
                        <select name="content_type" required id="contentTypeSelect" onchange="updateFormPlaceholders()">
                            <option value="contact_info">Th√¥ng tin li√™n h·ªá</option>
                            <option value="announcement">Th√¥ng b√°o</option>
                        </select>
                        <small class="form-help">
                            <strong>Th√¥ng tin li√™n h·ªá:</strong> Hi·ªÉn th·ªã ·ªü trang Li√™n h·ªá<br>
                            <strong>Th√¥ng b√°o:</strong> Hi·ªÉn th·ªã ·ªü trang ch·ªß
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i</label>
                        <select name="status">
                            <option value="active">Ho·∫°t ƒë·ªông</option>
                            <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ</label>
                    <input type="text" name="title" required id="titleInput" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ...">
                    <small class="form-help" id="titleHelp">V√≠ d·ª•: ƒê·ªãa ch·ªâ, ƒêi·ªán tho·∫°i, Email...</small>
                </div>
                <div class="form-group">
                    <label>N·ªôi dung</label>
                    <textarea name="content" rows="6" required id="contentInput" placeholder="Nh·∫≠p n·ªôi dung..."></textarea>
                    <small class="form-help" id="contentHelp">Nh·∫≠p th√¥ng tin chi ti·∫øt...</small>
                </div>
                <button type="submit" class="btn btn-primary">Th√™m n·ªôi dung</button>
            </form>
        </div>
    </div>

    <!-- Edit Content Modal -->
    <div id="editContentModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Ch·ªânh s·ª≠a n·ªôi dung</h2>
                <span class="close" onclick="closeAdminModal('editContentModal')">&times;</span>
            </div>
            <form id="editContentForm" class="admin-form">
                <input type="hidden" name="content_id" id="editContentId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Lo·∫°i n·ªôi dung</label>
                        <select name="content_type" id="editContentType" disabled>
                            <option value="contact_info">Th√¥ng tin li√™n h·ªá</option>
                            <option value="announcement">Th√¥ng b√°o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i</label>
                        <select name="status" id="editContentStatus">
                            <option value="active">Ho·∫°t ƒë·ªông</option>
                            <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Ti√™u ƒë·ªÅ</label>
                    <input type="text" name="title" id="editContentTitle" required>
                </div>
                <div class="form-group">
                    <label>N·ªôi dung</label>
                    <textarea name="content" id="editContentContent" rows="6" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t n·ªôi dung</button>
            </form>
        </div>
    </div>

    <!-- Detail Modals -->
    <!-- Enrollment Detail Modal -->
    <div id="enrollmentDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chi ti·∫øt ƒëƒÉng k√Ω kh√≥a h·ªçc</h2>
                <span class="close" onclick="closeAdminModal('enrollmentDetailModal')">&times;</span>
            </div>
            <div class="modal-body" id="enrollmentDetailContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Consultation Detail Modal -->
    <div id="consultationDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chi ti·∫øt y√™u c·∫ßu t∆∞ v·∫•n</h2>
                <span class="close" onclick="closeAdminModal('consultationDetailModal')">&times;</span>
            </div>
            <div class="modal-body" id="consultationDetailContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p admin khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            // Ki·ªÉm tra admin session
            checkAdminSession();
            
            // Hi·ªÉn th·ªã th√¥ng tin admin m·∫∑c ƒë·ªãnh
            document.getElementById('adminName').textContent = 'Hu·ª≥nh Ng·ªçc Minh Th∆∞';
            
            // Load dashboard data tr·ª±c ti·∫øp
            loadDashboardData();
        });

        function checkAdminSession() {
            // Test admin session b·∫±ng c√°ch g·ªçi API
            fetch('dp/admin_enrollments.php')
                .then(response => response.json())
                .then(data => {
                    if (!data.success && data.message === 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p') {
                        showAdminSessionWarning();
                    }
                })
                .catch(error => {
                    console.log('Session check failed:', error);
                });
        }

        function showAdminSessionWarning() {
            const warningDiv = document.createElement('div');
            warningDiv.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #dc2626; color: white; padding: 10px; text-align: center; z-index: 9999;">
                    <strong>‚ö†Ô∏è Ch∆∞a c√≥ quy·ªÅn admin!</strong> 
                    <button onclick="setupAdminSession()" style="background: white; color: #dc2626; border: none; padding: 5px 10px; margin-left: 10px; border-radius: 3px; cursor: pointer;">
                        Thi·∫øt l·∫≠p Admin Session
                    </button>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: transparent; color: white; border: 1px solid white; padding: 5px 10px; margin-left: 5px; border-radius: 3px; cursor: pointer;">
                        ƒê√≥ng
                    </button>
                </div>
            `;
            document.body.appendChild(warningDiv);
        }

        function setupAdminSession() {
            window.location.href = 'dp/set_admin_session_quick.php';
        }

        function loadDashboardData() {
            // Load th·ªëng k√™ dashboard
            fetch('dp/admin_dashboard.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('totalUsers').textContent = data.stats.totalUsers;
                        document.getElementById('totalCourses').textContent = data.stats.totalCourses || 6;
                        document.getElementById('totalEnrollments').textContent = data.stats.totalEnrollments;
                        document.getElementById('totalConsultations').textContent = data.stats.totalConsultations || 0;
                        
                        // Load recent activities if available
                        if (data.recentActivities) {
                            loadRecentActivities(data.recentActivities);
                        }
                        
                        console.log('Dashboard loaded successfully');
                    } else {
                        console.error('Dashboard error:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error loading dashboard:', error);
                });
        }

        // H√†m checkAdminLogin ƒë√£ b·ªã x√≥a ƒë·ªÉ tr√°nh redirect loop
        
        // H√†m loadAdminDashboardSafe ƒë√£ ƒë∆∞·ª£c thay th·∫ø b·∫±ng loadDashboardData

        function adminLogout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.location.href = 'dp/admin_logout.php';
            }
        }



        function loadRecentActivities(activities) {
            const container = document.getElementById('recentActivities');
            if (!activities || activities.length === 0) {
                container.innerHTML = '<p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>';
                return;
            }
            
            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-info">
                        <strong>${activity.user_name}</strong> ƒëƒÉng k√Ω kh√≥a h·ªçc 
                        <strong>${activity.course_title}</strong>
                    </div>
                    <div class="activity-time">
                        ${new Date(activity.enrolled_at).toLocaleDateString('vi-VN')}
                    </div>
                    <div class="activity-status status-${activity.status}">
                        ${getStatusText(activity.status)}
                    </div>
                </div>
            `).join('');
        }

        function loadUsers() {
            fetch('dp/admin_users.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayUsers(data.users);
                    }
                })
                .catch(error => {
                    console.error('Error loading users:', error);
                });
        }

        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            if (!users || users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Ch∆∞a c√≥ h·ªçc vi√™n n√†o</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.full_name}</td>
                    <td>${user.email}</td>
                    <td>${new Date(user.created_at).toLocaleDateString('vi-VN')}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function loadEnrollments() {
            // Try main API first, fallback to no-auth version
            fetch('dp/admin_enrollments.php')
                .then(response => response.json())
                .then(data => {
                    console.log('Enrollments loaded:', data);
                    if (data.success) {
                        displayEnrollments(data.enrollments);
                    } else if (data.message === 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p') {
                        // Fallback to no-auth version
                        return fetch('dp/admin_enrollments_no_auth.php')
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    displayEnrollments(data.enrollments);
                                    showAdminSessionWarning();
                                } else {
                                    console.error('Failed to load enrollments:', data);
                                }
                            });
                    } else {
                        console.error('Failed to load enrollments:', data);
                    }
                })
                .catch(error => {
                    console.error('Error loading enrollments:', error);
                    // Try no-auth version as fallback
                    fetch('dp/admin_enrollments_no_auth.php')
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayEnrollments(data.enrollments);
                                showAdminSessionWarning();
                            }
                        })
                        .catch(err => console.error('Fallback also failed:', err));
                });
        }

        function displayEnrollments(enrollments) {
            const tbody = document.getElementById('enrollmentsTableBody');
            if (!enrollments || enrollments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b;">Ch∆∞a c√≥ ƒëƒÉng k√Ω kh√≥a h·ªçc n√†o</td></tr>';
                return;
            }
            
            tbody.innerHTML = enrollments.map(enrollment => `
                <tr>
                    <td>${enrollment.id}</td>
                    <td>
                        <div><strong>${enrollment.user_name}</strong></div>
                        <div class="text-muted">${enrollment.user_email}</div>
                    </td>
                    <td>${enrollment.course_title}</td>
                    <td>${new Date(enrollment.enrolled_at).toLocaleDateString('vi-VN')}</td>
                    <td>
                        <select class="status-select" onchange="updateEnrollmentStatus(${enrollment.id}, this.value)">
                            <option value="pending" ${enrollment.status === 'pending' ? 'selected' : ''}>Ch·ªù x·ª≠ l√Ω</option>
                            <option value="approved" ${enrollment.status === 'approved' ? 'selected' : ''}>ƒê√£ duy·ªát</option>
                        </select>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewEnrollmentDetails(${enrollment.id})" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEnrollment(${enrollment.id})" title="X√≥a ƒëƒÉng k√Ω">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function loadConsultations() {
            fetch('dp/admin_consultations.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayConsultations(data.consultations);
                    } else {
                        console.error('Error:', data.message);
                        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói trong b·∫£ng
                        const tbody = document.getElementById('consultationsTableBody');
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #ef4444;">L·ªói t·∫£i d·ªØ li·ªáu: ' + data.message + '</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading consultations:', error);
                    const tbody = document.getElementById('consultationsTableBody');
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #ef4444;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t∆∞ v·∫•n</td></tr>';
                });
        }

        function displayConsultations(consultations) {
            const tbody = document.getElementById('consultationsTableBody');
            if (!consultations || consultations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #64748b;">Ch∆∞a c√≥ y√™u c·∫ßu t∆∞ v·∫•n n√†o</td></tr>';
                return;
            }
            
            tbody.innerHTML = consultations.map(consultation => `
                <tr>
                    <td>${consultation.id}</td>
                    <td>${consultation.full_name}</td>
                    <td>${consultation.email}</td>
                    <td>${consultation.phone}</td>
                    <td>${consultation.course_interest || 'N/A'}</td>
                    <td>${new Date(consultation.created_at).toLocaleDateString('vi-VN')}</td>
                    <td>
                        <select class="status-select" onchange="updateConsultationStatus(${consultation.id}, this.value)">
                            <option value="new" ${consultation.status === 'new' ? 'selected' : ''}>M·ªõi</option>
                            <option value="processing" ${consultation.status === 'processing' ? 'selected' : ''}>ƒêang x·ª≠ l√Ω</option>
                            <option value="completed" ${consultation.status === 'completed' ? 'selected' : ''}>Ho√†n th√†nh</option>
                        </select>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewConsultationDetails(${consultation.id})" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteConsultation(${consultation.id})" title="X√≥a y√™u c·∫ßu">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateEnrollmentStatus(enrollmentId, status) {
            console.log('Updating enrollment:', enrollmentId, 'to status:', status);
            
            // Try main API first
            fetch('dp/admin_enrollments.php', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    enrollment_id: enrollmentId,
                    status: status
                })
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.success) {
                    alert('‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng');
                    loadEnrollments(); // Reload data
                } else if (data.message === 'Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p') {
                    // Try no-auth version
                    return fetch('dp/admin_enrollments_no_auth.php', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            enrollment_id: enrollmentId,
                            status: status
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng (no-auth)');
                            loadEnrollments();
                            showAdminSessionWarning();
                        } else {
                            alert('‚ùå L·ªói: ' + data.message);
                            console.error('Error details:', data);
                        }
                    });
                } else {
                    alert('‚ùå L·ªói: ' + data.message);
                    console.error('Error details:', data);
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message);
            });
        }

        function deleteEnrollment(enrollmentId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒëƒÉng k√Ω n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                fetch('dp/admin_enrollments.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        enrollment_id: enrollmentId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('X√≥a ƒëƒÉng k√Ω th√†nh c√¥ng');
                        loadEnrollments(); // Reload data
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi x√≥a ƒëƒÉng k√Ω');
                });
            }
        }

        function updateConsultationStatus(consultationId, status) {
            fetch('dp/admin_consultations.php', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    consultation_id: consultationId,
                    status: status
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng');
                    loadConsultations(); // Reload data
                } else {
                    alert('L·ªói: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra');
            });
        }

        function deleteConsultation(consultationId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a y√™u c·∫ßu t∆∞ v·∫•n n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                fetch('dp/admin_consultations.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        consultation_id: consultationId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('X√≥a y√™u c·∫ßu t∆∞ v·∫•n th√†nh c√¥ng');
                        loadConsultations(); // Reload data
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi x√≥a y√™u c·∫ßu');
                });
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Ch·ªù x·ª≠ l√Ω',
                'active': 'ƒê√£ duy·ªát',
                'completed': 'Ho√†n th√†nh',
                'new': 'M·ªõi',
                'processing': 'ƒêang x·ª≠ l√Ω'
            };
            return statusMap[status] || status;
        }

        // C√°c function c√≤n thi·∫øu
        function deleteUser(userId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?')) {
                fetch('dp/admin_users.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('X√≥a ng∆∞·ªùi d√πng th√†nh c√¥ng');
                        loadUsers(); // Reload data
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra');
                });
            }
        }

        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'block';
        }

        function showAddCourseModal() {
            document.getElementById('addCourseModal').style.display = 'block';
        }

        function closeAdminModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function viewEnrollmentDetails(enrollmentId) {
            // L·∫•y chi ti·∫øt ƒëƒÉng k√Ω t·ª´ server
            fetch(`dp/admin_enrollments.php?id=${enrollmentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const enrollment = data.enrollment;
                        const content = document.getElementById('enrollmentDetailContent');
                        
                        // Parse course features n·∫øu c√≥
                        let features = [];
                        try {
                            features = JSON.parse(enrollment.course_features || '[]');
                        } catch (e) {
                            features = [];
                        }
                        
                        content.innerHTML = `
                            <div class="detail-section">
                                <h3><i class="fas fa-user"></i> Th√¥ng tin h·ªçc vi√™n</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>H·ªç t√™n:</label>
                                        <span>${enrollment.user_name}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Email:</label>
                                        <span>${enrollment.user_email}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Ng√†y ƒëƒÉng k√Ω t√†i kho·∫£n:</label>
                                        <span>${new Date(enrollment.user_created_at).toLocaleDateString('vi-VN')}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h3><i class="fas fa-book"></i> Th√¥ng tin kh√≥a h·ªçc</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>T√™n kh√≥a h·ªçc:</label>
                                        <span>${enrollment.course_title}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>H·ªçc ph√≠:</label>
                                        <span>${new Intl.NumberFormat('vi-VN').format(enrollment.course_price)} VNƒê/th√°ng</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Th·ªùi l∆∞·ª£ng:</label>
                                        <span>${enrollment.course_duration} th√°ng</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Tr√¨nh ƒë·ªô:</label>
                                        <span>${enrollment.course_level}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>L·ªãch h·ªçc:</label>
                                        <span>${enrollment.course_schedule}</span>
                                    </div>
                                </div>
                                
                                <div class="detail-item full-width">
                                    <label>M√¥ t·∫£ kh√≥a h·ªçc:</label>
                                    <p>${enrollment.course_description}</p>
                                </div>
                                
                                ${features.length > 0 ? `
                                <div class="detail-item full-width">
                                    <label>T√≠nh nƒÉng n·ªïi b·∫≠t:</label>
                                    <ul class="feature-list">
                                        ${features.map(feature => `<li>${feature}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="detail-section">
                                <h3><i class="fas fa-info-circle"></i> Th√¥ng tin ƒëƒÉng k√Ω</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>Ng√†y ƒëƒÉng k√Ω:</label>
                                        <span>${new Date(enrollment.enrolled_at).toLocaleDateString('vi-VN')} ${new Date(enrollment.enrolled_at).toLocaleTimeString('vi-VN')}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Tr·∫°ng th√°i:</label>
                                        <span class="status-badge status-${enrollment.status}">${getStatusText(enrollment.status)}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Hi·ªÉn th·ªã modal
                        document.getElementById('enrollmentDetailModal').style.display = 'block';
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i chi ti·∫øt');
                });
        }

        function viewConsultationDetails(consultationId) {
            // L·∫•y chi ti·∫øt t∆∞ v·∫•n t·ª´ server
            fetch(`dp/admin_consultations.php?id=${consultationId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const consultation = data.consultation;
                        const content = document.getElementById('consultationDetailContent');
                        
                        content.innerHTML = `
                            <div class="detail-section">
                                <h3><i class="fas fa-user"></i> Th√¥ng tin li√™n h·ªá</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>H·ªç t√™n:</label>
                                        <span>${consultation.full_name}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Email:</label>
                                        <span><a href="mailto:${consultation.email}">${consultation.email}</a></span>
                                    </div>
                                    <div class="detail-item">
                                        <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                                        <span><a href="tel:${consultation.phone}">${consultation.phone}</a></span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Kh√≥a h·ªçc quan t√¢m:</label>
                                        <span>${consultation.course_interest || 'Ch∆∞a ch·ªçn'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h3><i class="fas fa-comment"></i> N·ªôi dung tin nh·∫Øn</h3>
                                <div class="message-content">
                                    <p>${consultation.message || 'Kh√¥ng c√≥ tin nh·∫Øn'}</p>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h3><i class="fas fa-info-circle"></i> Th√¥ng tin x·ª≠ l√Ω</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>Ng√†y g·ª≠i:</label>
                                        <span>${new Date(consultation.created_at).toLocaleDateString('vi-VN')} ${new Date(consultation.created_at).toLocaleTimeString('vi-VN')}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Tr·∫°ng th√°i:</label>
                                        <span class="status-badge status-${consultation.status}">${getStatusText(consultation.status)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-actions">
                                <button class="btn btn-primary" onclick="updateConsultationStatusFromModal(${consultation.id}, 'processing')">
                                    <i class="fas fa-play"></i> ƒêang x·ª≠ l√Ω
                                </button>
                                <button class="btn btn-success" onclick="updateConsultationStatusFromModal(${consultation.id}, 'completed')">
                                    <i class="fas fa-check"></i> Ho√†n th√†nh
                                </button>
                                <button class="btn btn-secondary" onclick="closeAdminModal('consultationDetailModal')">
                                    <i class="fas fa-times"></i> ƒê√≥ng
                                </button>
                            </div>
                        `;
                        
                        // Hi·ªÉn th·ªã modal
                        document.getElementById('consultationDetailModal').style.display = 'block';
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i chi ti·∫øt');
                });
        }

        function updateConsultationStatusFromModal(consultationId, status) {
            fetch('dp/admin_consultations.php', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    consultation_id: consultationId,
                    status: status
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng');
                    closeAdminModal('consultationDetailModal');
                    loadConsultations(); // Reload data
                } else {
                    alert('L·ªói: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra');
            });
        }

        // Course Management Functions
        function loadCourses() {
            fetch('dp/admin_courses.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCourses(data.courses);
                    } else {
                        console.error('Error:', data.message);
                        const tbody = document.getElementById('coursesTableBody');
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #ef4444;">L·ªói t·∫£i d·ªØ li·ªáu: ' + data.message + '</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading courses:', error);
                    const tbody = document.getElementById('coursesTableBody');
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #ef4444;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu kh√≥a h·ªçc</td></tr>';
                });
        }

        function displayCourses(courses) {
            const tbody = document.getElementById('coursesTableBody');
            if (!courses || courses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #64748b;">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o</td></tr>';
                return;
            }
            
            tbody.innerHTML = courses.map(course => `
                <tr>
                    <td>${course.id}</td>
                    <td>
                        <div><strong>${course.title}</strong></div>
                        <div class="text-muted">${course.level}</div>
                    </td>
                    <td>
                        <span class="badge badge-${getCategoryClass(course.category)}">${getCategoryText(course.category)}</span>
                    </td>
                    <td>${new Intl.NumberFormat('vi-VN').format(course.price)} VNƒê</td>
                    <td>${course.duration} th√°ng</td>
                    <td>
                        <select class="status-select" onchange="updateCourseStatus(${course.id}, this.value)">
                            <option value="active" ${course.status === 'active' ? 'selected' : ''}>Ho·∫°t ƒë·ªông</option>
                            <option value="inactive" ${course.status === 'inactive' ? 'selected' : ''}>Kh√¥ng ho·∫°t ƒë·ªông</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewCourseDetails(${course.id})" title="Xem chi ti·∫øt">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="editCourse(${course.id})" title="Ch·ªânh s·ª≠a">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCourse(${course.id})" title="X√≥a">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getCategoryClass(category) {
            const classes = {
                'language': 'primary',
                'it': 'success',
                'marketing': 'warning'
            };
            return classes[category] || 'secondary';
        }

        function getCategoryText(category) {
            const texts = {
                'language': 'Ngo·∫°i ng·ªØ',
                'it': 'Tin h·ªçc',
                'marketing': 'Marketing'
            };
            return texts[category] || category;
        }

        function updateCourseStatus(courseId, status) {
            fetch('dp/admin_courses.php', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    course_id: courseId,
                    status: status
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng');
                    loadCourses(); // Reload data
                } else {
                    alert('L·ªói: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra');
            });
        }

        function viewCourseDetails(courseId) {
            fetch(`dp/admin_courses.php?id=${courseId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const course = data.course;
                        const content = document.getElementById('courseDetailContent');
                        
                        content.innerHTML = `
                            <div class="detail-section">
                                <h3><i class="fas fa-book"></i> Th√¥ng tin kh√≥a h·ªçc</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <label>T√™n kh√≥a h·ªçc:</label>
                                        <span>${course.title}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Danh m·ª•c:</label>
                                        <span class="badge badge-${getCategoryClass(course.category)}">${getCategoryText(course.category)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>H·ªçc ph√≠:</label>
                                        <span>${new Intl.NumberFormat('vi-VN').format(course.price)} VNƒê/th√°ng</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Th·ªùi l∆∞·ª£ng:</label>
                                        <span>${course.duration} th√°ng</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Tr√¨nh ƒë·ªô:</label>
                                        <span>${course.level}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>L·ªãch h·ªçc:</label>
                                        <span>${course.schedule || 'Ch∆∞a c·∫≠p nh·∫≠t'}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Tr·∫°ng th√°i:</label>
                                        <span class="status-badge status-${course.status}">${course.status === 'active' ? 'Ho·∫°t ƒë·ªông' : 'Kh√¥ng ho·∫°t ƒë·ªông'}</span>
                                    </div>
                                    <div class="detail-item">
                                        <label>Ng√†y t·∫°o:</label>
                                        <span>${new Date(course.created_at).toLocaleDateString('vi-VN')} ${new Date(course.created_at).toLocaleTimeString('vi-VN')}</span>
                                    </div>
                                </div>
                                
                                <div class="detail-item full-width">
                                    <label>M√¥ t·∫£ kh√≥a h·ªçc:</label>
                                    <p>${course.description || 'Ch∆∞a c√≥ m√¥ t·∫£'}</p>
                                </div>
                                
                                ${course.features && course.features.length > 0 ? `
                                <div class="detail-item full-width">
                                    <label>T√≠nh nƒÉng n·ªïi b·∫≠t:</label>
                                    <ul class="feature-list">
                                        ${course.features.map(feature => `<li>${feature}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                            </div>
                        `;
                        
                        document.getElementById('courseDetailModal').style.display = 'block';
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i chi ti·∫øt');
                });
        }

        function editCourse(courseId) {
            fetch(`dp/admin_courses.php?id=${courseId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const course = data.course;
                        
                        // Fill form with course data
                        document.getElementById('editCourseId').value = course.id;
                        document.getElementById('editCourseTitle').value = course.title;
                        document.getElementById('editCourseDescription').value = course.description || '';
                        document.getElementById('editCourseCategory').value = course.category;
                        document.getElementById('editCoursePrice').value = course.price;
                        document.getElementById('editCourseDuration').value = course.duration;
                        document.getElementById('editCourseLevel').value = course.level;
                        document.getElementById('editCourseSchedule').value = course.schedule || '';
                        document.getElementById('editCourseFeatures').value = course.features ? course.features.join('\n') : '';
                        
                        document.getElementById('editCourseModal').style.display = 'block';
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i th√¥ng tin kh√≥a h·ªçc');
                });
        }

        function deleteCourse(courseId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√≥a h·ªçc n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                fetch('dp/admin_courses.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        course_id: courseId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('X√≥a kh√≥a h·ªçc th√†nh c√¥ng');
                        loadCourses(); // Reload data
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra');
                });
            }
        }



        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.admin-sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const sidebar = document.querySelector('.admin-sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Navigation between sections
        document.addEventListener('DOMContentLoaded', function() {
            const menuItems = document.querySelectorAll('.menu-item');
            const sections = document.querySelectorAll('.admin-section');
            
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.dataset.section;
                    
                    // Update active menu item
                    menuItems.forEach(mi => mi.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === sectionId) {
                            section.classList.add('active');
                        }
                    });
                    
                    // Load data for specific sections when clicked
                    switch(sectionId) {
                        case 'users':
                            loadUsers();
                            break;
                        case 'courses':
                            loadCourses();
                            break;
                        case 'enrollments':
                            loadEnrollments();
                            break;
                        case 'consultations':
                            loadConsultations();
                            break;
                        case 'content':
                            loadContent();
                            break;
                        case 'analytics':
                            loadAnalytics();
                            break;
                        case 'dashboard':
                            loadDashboardData();
                            break;
                    }
                });
            });
            
            // Handle form submissions
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const userData = {
                        full_name: formData.get('full_name'),
                        email: formData.get('email'),
                        password: formData.get('password')
                    };
                    
                    fetch('dp/admin_users.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Th√™m h·ªçc vi√™n th√†nh c√¥ng');
                            closeAdminModal('addUserModal');
                            this.reset();
                            loadUsers();
                        } else {
                            alert('L·ªói: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('C√≥ l·ªói x·∫£y ra');
                    });
                });
            }

            // Handle add course form
            const addCourseForm = document.getElementById('addCourseForm');
            if (addCourseForm) {
                addCourseForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const features = formData.get('features').split('\n').filter(f => f.trim() !== '');
                    
                    const courseData = {
                        title: formData.get('title'),
                        description: formData.get('description'),
                        category: formData.get('category'),
                        price: parseFloat(formData.get('price')),
                        duration: parseInt(formData.get('duration')),
                        level: formData.get('level'),
                        schedule: formData.get('schedule'),
                        features: features
                    };
                    
                    fetch('dp/admin_courses.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(courseData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Th√™m kh√≥a h·ªçc th√†nh c√¥ng');
                            closeAdminModal('addCourseModal');
                            this.reset();
                            loadCourses();
                        } else {
                            alert('L·ªói: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('C√≥ l·ªói x·∫£y ra');
                    });
                });
            }

            // Handle edit course form
            const editCourseForm = document.getElementById('editCourseForm');
            if (editCourseForm) {
                editCourseForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const features = formData.get('features').split('\n').filter(f => f.trim() !== '');
                    
                    const courseData = {
                        course_id: parseInt(formData.get('course_id')),
                        title: formData.get('title'),
                        description: formData.get('description'),
                        category: formData.get('category'),
                        price: parseFloat(formData.get('price')),
                        duration: parseInt(formData.get('duration')),
                        level: formData.get('level'),
                        schedule: formData.get('schedule'),
                        features: features
                    };
                    
                    fetch('dp/admin_courses.php', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(courseData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('C·∫≠p nh·∫≠t kh√≥a h·ªçc th√†nh c√¥ng');
                            closeAdminModal('editCourseModal');
                            loadCourses();
                        } else {
                            alert('L·ªói: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('C√≥ l·ªói x·∫£y ra');
                    });
                });
            }
            
            // Handle search and filters
            const userSearch = document.getElementById('userSearch');
            if (userSearch) {
                userSearch.addEventListener('input', function() {
                    const searchTerm = this.value;
                    fetch(`dp/admin_users.php?search=${encodeURIComponent(searchTerm)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayUsers(data.users);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }
            
            const enrollmentSearch = document.getElementById('enrollmentSearch');
            if (enrollmentSearch) {
                enrollmentSearch.addEventListener('input', function() {
                    const searchTerm = this.value;
                    const status = document.getElementById('enrollmentStatusFilter').value;
                    
                    let url = 'dp/admin_enrollments.php?';
                    const params = [];
                    
                    if (searchTerm) {
                        params.push(`search=${encodeURIComponent(searchTerm)}`);
                    }
                    if (status) {
                        params.push(`status=${encodeURIComponent(status)}`);
                    }
                    
                    url += params.join('&');
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayEnrollments(data.enrollments);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }
            
            // Handle enrollment status filter
            const enrollmentStatusFilter = document.getElementById('enrollmentStatusFilter');
            if (enrollmentStatusFilter) {
                enrollmentStatusFilter.addEventListener('change', function() {
                    const searchTerm = document.getElementById('enrollmentSearch').value;
                    const status = this.value;
                    
                    let url = 'dp/admin_enrollments.php?';
                    const params = [];
                    
                    if (searchTerm) {
                        params.push(`search=${encodeURIComponent(searchTerm)}`);
                    }
                    if (status) {
                        params.push(`status=${encodeURIComponent(status)}`);
                    }
                    
                    url += params.join('&');
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayEnrollments(data.enrollments);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }
            
            const consultationSearch = document.getElementById('consultationSearch');
            if (consultationSearch) {
                consultationSearch.addEventListener('input', function() {
                    const searchTerm = this.value;
                    const status = document.getElementById('consultationStatusFilter').value;
                    
                    let url = 'dp/admin_consultations.php?';
                    const params = [];
                    
                    if (searchTerm) {
                        params.push(`search=${encodeURIComponent(searchTerm)}`);
                    }
                    if (status) {
                        params.push(`status=${encodeURIComponent(status)}`);
                    }
                    
                    url += params.join('&');
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayConsultations(data.consultations);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }
            
            // Handle consultation status filter
            const consultationStatusFilter = document.getElementById('consultationStatusFilter');
            if (consultationStatusFilter) {
                consultationStatusFilter.addEventListener('change', function() {
                    const searchTerm = document.getElementById('consultationSearch').value;
                    const status = this.value;
                    
                    let url = 'dp/admin_consultations.php?';
                    const params = [];
                    
                    if (searchTerm) {
                        params.push(`search=${encodeURIComponent(searchTerm)}`);
                    }
                    if (status) {
                        params.push(`status=${encodeURIComponent(status)}`);
                    }
                    
                    url += params.join('&');
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                displayConsultations(data.consultations);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }

            // Handle course search and filters
            const courseSearch = document.getElementById('courseSearch');
            if (courseSearch) {
                courseSearch.addEventListener('input', function() {
                    filterCourses();
                });
            }

            const courseCategoryFilter = document.getElementById('courseCategoryFilter');
            if (courseCategoryFilter) {
                courseCategoryFilter.addEventListener('change', function() {
                    filterCourses();
                });
            }

            const courseStatusFilter = document.getElementById('courseStatusFilter');
            if (courseStatusFilter) {
                courseStatusFilter.addEventListener('change', function() {
                    filterCourses();
                });
            }

            function filterCourses() {
                const search = document.getElementById('courseSearch').value;
                const category = document.getElementById('courseCategoryFilter').value;
                const status = document.getElementById('courseStatusFilter').value;
                
                let url = 'dp/admin_courses.php?';
                const params = [];
                
                if (search) params.push(`search=${encodeURIComponent(search)}`);
                if (category) params.push(`category=${encodeURIComponent(category)}`);
                if (status) params.push(`status=${encodeURIComponent(status)}`);
                
                url += params.join('&');
                
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayCourses(data.courses);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }

            // Handle add content form
            const addContentForm = document.getElementById('addContentForm');
            if (addContentForm) {
                addContentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const contentData = {
                        content_type: formData.get('content_type'),
                        title: formData.get('title'),
                        content: formData.get('content'),
                        status: formData.get('status')
                    };
                    
                    fetch('dp/admin_content.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Th√™m n·ªôi dung th√†nh c√¥ng');
                            closeAdminModal('addContentModal');
                            this.reset();
                            loadContent();
                        } else {
                            alert('L·ªói: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('C√≥ l·ªói x·∫£y ra');
                    });
                });
            }

            // Handle edit content form
            const editContentForm = document.getElementById('editContentForm');
            if (editContentForm) {
                editContentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const contentData = {
                        content_id: parseInt(formData.get('content_id')),
                        title: formData.get('title'),
                        content: formData.get('content'),
                        status: formData.get('status')
                    };
                    
                    fetch('dp/admin_content.php', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contentData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('C·∫≠p nh·∫≠t n·ªôi dung th√†nh c√¥ng');
                            closeAdminModal('editContentModal');
                            loadContent();
                        } else {
                            alert('L·ªói: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('C√≥ l·ªói x·∫£y ra');
                    });
                });
            }
        });

        // Content Management Functions
        function loadContent() {
            fetch('dp/admin_content.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayContent(data.content);
                    } else {
                        console.error('Error:', data.message);
                        const tbody = document.getElementById('contentTableBody');
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #ef4444;">L·ªói t·∫£i d·ªØ li·ªáu: ' + data.message + '</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error loading content:', error);
                    const tbody = document.getElementById('contentTableBody');
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #ef4444;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu n·ªôi dung</td></tr>';
                });
        }

        function displayContent(contents) {
            const tbody = document.getElementById('contentTableBody');
            if (!contents || contents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b;">Ch∆∞a c√≥ n·ªôi dung n√†o</td></tr>';
                return;
            }
            
            tbody.innerHTML = contents.map(content => `
                <tr>
                    <td>${content.id}</td>
                    <td>
                        <span class="badge badge-${getContentTypeClass(content.content_type)}">${getContentTypeText(content.content_type)}</span>
                    </td>
                    <td>
                        <div><strong>${content.title}</strong></div>
                        <div class="text-muted">${content.content ? content.content.substring(0, 50) + '...' : ''}</div>
                    </td>
                    <td>
                        <span class="status-badge status-${content.status}">${content.status === 'active' ? 'Ho·∫°t ƒë·ªông' : 'Kh√¥ng ho·∫°t ƒë·ªông'}</span>
                    </td>
                    <td>${new Date(content.updated_at).toLocaleDateString('vi-VN')}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editContent(${content.id})" title="Ch·ªânh s·ª≠a">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteContent(${content.id})" title="X√≥a">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getContentTypeClass(type) {
            const classes = {
                'contact_info': 'warning',
                'announcement': 'info'
            };
            return classes[type] || 'secondary';
        }

        function getContentTypeText(type) {
            const texts = {
                'contact_info': 'Th√¥ng tin li√™n h·ªá',
                'announcement': 'Th√¥ng b√°o'
            };
            return texts[type] || type;
        }

        function updateFormPlaceholders() {
            const contentType = document.getElementById('contentTypeSelect').value;
            const titleInput = document.getElementById('titleInput');
            const contentInput = document.getElementById('contentInput');
            const titleHelp = document.getElementById('titleHelp');
            const contentHelp = document.getElementById('contentHelp');
            
            if (contentType === 'contact_info') {
                titleInput.placeholder = 'V√≠ d·ª•: ƒê·ªãa ch·ªâ, ƒêi·ªán tho·∫°i, Email, Gi·ªù l√†m vi·ªác...';
                contentInput.placeholder = 'V√≠ d·ª•: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM\nho·∫∑c (028) 1234 5678\nho·∫∑c info@abccenter.edu.vn';
                titleHelp.textContent = 'T√™n lo·∫°i th√¥ng tin li√™n h·ªá (s·∫Ω hi·ªÉn th·ªã ·ªü trang Li√™n h·ªá)';
                contentHelp.textContent = 'Chi ti·∫øt th√¥ng tin li√™n h·ªá. C√≥ th·ªÉ xu·ªëng d√≤ng b·∫±ng Enter.';
            } else if (contentType === 'announcement') {
                titleInput.placeholder = 'V√≠ d·ª•: Th√¥ng b√°o tuy·ªÉn sinh, L·ªãch ngh·ªâ l·ªÖ, Khuy·∫øn m√£i...';
                contentInput.placeholder = 'V√≠ d·ª•: Trung t√¢m th√¥ng b√°o tuy·ªÉn sinh kh√≥a h·ªçc m·ªõi t·ª´ ng√†y 1/1/2024. ∆Øu ƒë√£i gi·∫£m 20% h·ªçc ph√≠ cho 50 h·ªçc vi√™n ƒëƒÉng k√Ω s·ªõm...';
                titleHelp.textContent = 'Ti√™u ƒë·ªÅ th√¥ng b√°o (s·∫Ω hi·ªÉn th·ªã ·ªü trang ch·ªß)';
                contentHelp.textContent = 'N·ªôi dung chi ti·∫øt c·ªßa th√¥ng b√°o. C√≥ th·ªÉ xu·ªëng d√≤ng b·∫±ng Enter.';
            }
        }

        function showAddContentModal() {
            document.getElementById('addContentModal').style.display = 'block';
        }

        function editContent(contentId) {
            fetch(`dp/admin_content.php?id=${contentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.content.length > 0) {
                        const content = data.content[0];
                        
                        document.getElementById('editContentId').value = content.id;
                        document.getElementById('editContentType').value = content.content_type;
                        document.getElementById('editContentTitle').value = content.title;
                        document.getElementById('editContentContent').value = content.content || '';
                        document.getElementById('editContentStatus').value = content.status;
                        
                        document.getElementById('editContentModal').style.display = 'block';
                    } else {
                        alert('Kh√¥ng t√¨m th·∫•y n·ªôi dung');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i n·ªôi dung');
                });
        }

        function deleteContent(contentId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a n·ªôi dung n√†y?')) {
                fetch('dp/admin_content.php', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content_id: contentId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('X√≥a n·ªôi dung th√†nh c√¥ng');
                        loadContent();
                    } else {
                        alert('L·ªói: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('C√≥ l·ªói x·∫£y ra');
                });
            }
        }

        // Simple Analytics Functions
        function loadAnalytics() {
            // Load basic stats
            loadBasicStats();
            loadPopularCourses();
            loadRecentActivity();
        }

        function loadBasicStats() {
            // S·ª≠ d·ª•ng c√πng API dashboard ƒë·ªÉ l·∫•y th·ªëng k√™
            fetch('dp/admin_dashboard.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('analyticsUsers').textContent = data.stats.totalUsers;
                        document.getElementById('analyticsEnrollments').textContent = data.stats.totalEnrollments;
                        document.getElementById('analyticsConsultations').textContent = data.stats.totalConsultations;
                        
                        // Load today visits (simplified)
                        document.getElementById('analyticsVisits').textContent = data.stats.newUsersThisMonth || 0;
                    }
                })
                .catch(error => {
                    console.log('Error loading analytics:', error);
                    // Set default values on error
                    document.getElementById('analyticsUsers').textContent = '0';
                    document.getElementById('analyticsEnrollments').textContent = '0';
                    document.getElementById('analyticsConsultations').textContent = '0';
                    document.getElementById('analyticsVisits').textContent = '0';
                });
        }

        function loadPopularCourses() {
            fetch('dp/admin_enrollments.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.enrollments.length > 0) {
                        // Count enrollments by course
                        const courseCounts = {};
                        data.enrollments.forEach(enrollment => {
                            const course = enrollment.course_title;
                            courseCounts[course] = (courseCounts[course] || 0) + 1;
                        });

                        // Sort by count
                        const sortedCourses = Object.entries(courseCounts)
                            .sort(([,a], [,b]) => b - a)
                            .slice(0, 5);

                        let html = '';
                        if (sortedCourses.length > 0) {
                            html = sortedCourses.map(([course, count]) => `
                                <div class="simple-item">
                                    <span>${course}</span>
                                    <span class="count">${count} ƒëƒÉng k√Ω</span>
                                </div>
                            `).join('');
                        } else {
                            html = '<p>Ch∆∞a c√≥ ƒëƒÉng k√Ω n√†o</p>';
                        }

                        document.getElementById('popularCourses').innerHTML = html;
                    } else {
                        document.getElementById('popularCourses').innerHTML = '<p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
                    }
                })
                .catch(error => {
                    document.getElementById('popularCourses').innerHTML = '<p>L·ªói t·∫£i d·ªØ li·ªáu</p>';
                });
        }

        function loadRecentActivity() {
            Promise.all([
                fetch('dp/admin_enrollments.php').then(r => r.json()),
                fetch('dp/admin_consultations.php').then(r => r.json())
            ])
            .then(([enrollments, consultations]) => {
                const activities = [];

                // Add recent enrollments
                if (enrollments.success) {
                    enrollments.enrollments.slice(0, 3).forEach(enrollment => {
                        activities.push({
                            type: 'enrollment',
                            text: `${enrollment.user_name} ƒëƒÉng k√Ω kh√≥a ${enrollment.course_title}`,
                            time: enrollment.enrolled_at
                        });
                    });
                }

                // Add recent consultations
                if (consultations.success) {
                    consultations.consultations.slice(0, 3).forEach(consultation => {
                        activities.push({
                            type: 'consultation',
                            text: `${consultation.full_name} g·ª≠i y√™u c·∫ßu t∆∞ v·∫•n`,
                            time: consultation.created_at
                        });
                    });
                }

                // Sort by time and take top 5
                activities.sort((a, b) => new Date(b.time) - new Date(a.time));
                const recentActivities = activities.slice(0, 5);

                let html = '';
                if (recentActivities.length > 0) {
                    html = recentActivities.map(activity => `
                        <div class="simple-item">
                            <span>${activity.text}</span>
                            <span class="time">${formatTime(activity.time)}</span>
                        </div>
                    `).join('');
                } else {
                    html = '<p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>';
                }

                document.getElementById('recentActivity').innerHTML = html;
            })
            .catch(error => {
                document.getElementById('recentActivity').innerHTML = '<p>L·ªói t·∫£i d·ªØ li·ªáu</p>';
            });
        }

        function formatTime(timeString) {
            const date = new Date(timeString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) {
                return `${diffMins} ph√∫t tr∆∞·ªõc`;
            } else if (diffHours < 24) {
                return `${diffHours} gi·ªù tr∆∞·ªõc`;
            } else {
                return `${diffDays} ng√†y tr∆∞·ªõc`;
            }
        }
    </script>
</body>
</html>